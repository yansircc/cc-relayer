import{d as xt,c as kt,a as v,s as c,f as _,b as X}from"../chunks/Ce1JsnIe.js";import{o as wt}from"../chunks/DQV7xeGi.js";import{a1 as Dt,a2 as D,a3 as Y,s as E,a4 as Et,a5 as Z,a7 as St,g as t,a9 as e,aa as a,a6 as S,a8 as i,ac as $}from"../chunks/BLL442xA.js";import{i as T}from"../chunks/BBj9_ryw.js";import{e as C,i as G}from"../chunks/CrcuVASb.js";import{a as z}from"../chunks/0xq203u2.js";import{t as jt}from"../chunks/C5Uh6Ygl.js";const Tt=!1,Wt=Object.freeze(Object.defineProperty({__proto__:null,ssr:Tt},Symbol.toStringTag,{value:"Module"}));var zt=_('<p class="error-msg"> </p>'),Mt=_('<p class="loading">loading sessions...</p>'),Lt=_('<p class="muted">no pending oauth sessions</p>'),Ot=_('<tr><td class="muted"> </td><td> </td></tr>'),Pt=_("<table><thead><tr><th>session id</th><th>ttl</th></tr></thead><tbody></tbody></table>"),Ft=_('<p class="muted">no active session bindings</p>'),It=_('<tr><td class="muted"> </td><td> </td><td> </td><td> </td><td><a href="javascript:void(0)" style="font-size:12px">unbind</a></td></tr>'),qt=_("<table><thead><tr><th>session uuid</th><th>account</th><th>last used</th><th>ttl</th><th></th></tr></thead><tbody></tbody></table>"),At=_('<p class="muted">no active sticky sessions</p>'),Bt=_('<tr><td class="muted"> </td><td> </td><td> </td><td><a href="javascript:void(0)" style="font-size:12px">clear</a></td></tr>'),Ct=_("<table><thead><tr><th>hash</th><th>account</th><th>ttl</th><th></th></tr></thead><tbody></tbody></table>"),Gt=_('<h2>pending oauth sessions <span class="muted"> </span></h2> <!> <h2>session bindings <span class="muted"> </span></h2> <!> <h2>sticky sessions <span class="muted"> </span></h2> <!>',1);function Xt(U,tt){Dt(tt,!0);let p=D(null),j=D(Y([])),M=D(""),H=D(!0),J=D(Y(Date.now()));const at=setInterval(()=>{E(J,Date.now(),!0)},1e3);wt(()=>clearInterval(at)),Et(()=>{et()});async function et(){try{const[s,r]=await Promise.all([z("/sessions"),z("/sessions/oauth").catch(()=>[])]);E(p,s,!0),E(j,r,!0)}catch(s){E(M,s.message,!0)}finally{E(H,!1)}}function L(s){if(!s)return"-";const r=new Date(s).getTime()-t(J);if(r<=0)return"expired";const n=Math.floor(r/6e4);return n<60?`${n}m`:`${Math.floor(n/60)}h ${n%60}m`}async function st(s){var r;try{await z(`/sessions/binding/${s}`,{method:"DELETE"}),(r=t(p))!=null&&r.bindings&&(t(p).bindings=t(p).bindings.filter(n=>n.session_uuid!==s))}catch(n){alert(n.message)}}async function rt(s){var r;try{await z(`/sessions/sticky/${s}`,{method:"DELETE"}),(r=t(p))!=null&&r.sticky&&(t(p).sticky=t(p).sticky.filter(n=>n.hash!==s))}catch(n){alert(n.message)}}var K=kt(),ot=Z(K);{var it=s=>{var r=zt(),n=e(r,!0);a(r),S(()=>c(n,t(M))),v(s,r)},nt=s=>{var r=Mt();v(s,r)},dt=s=>{const r=$(()=>t(p).bindings??[]),n=$(()=>t(p).sticky??[]);var O=Gt(),P=Z(O),N=i(e(P)),lt=e(N);a(N),a(P);var Q=i(P,2);{var vt=o=>{var d=Lt();v(o,d)},ct=o=>{var d=Pt(),g=i(e(d));C(g,21,()=>t(j),G,(x,l)=>{var h=Ot(),u=e(h),k=e(u,!0);a(u);var f=i(u),w=e(f,!0);a(f),a(h),S(m=>{c(k,t(l).session_id),c(w,m)},[()=>L(t(l).expires_at)]),v(x,h)}),a(g),a(d),v(o,d)};T(Q,o=>{t(j).length===0?o(vt):o(ct,!1)})}var F=i(Q,2),R=i(e(F)),_t=e(R);a(R),a(F);var V=i(F,2);{var ht=o=>{var d=Ft();v(o,d)},ut=o=>{var d=qt(),g=i(e(d));C(g,21,()=>t(r),G,(x,l)=>{var h=It(),u=e(h),k=e(u,!0);a(u);var f=i(u),w=e(f,!0);a(f);var m=i(f),q=e(m,!0);a(m);var y=i(m),A=e(y,!0);a(y);var b=i(y),yt=e(b);a(b),a(h),S((B,bt)=>{c(k,t(l).session_uuid),c(w,t(l).account_id),c(q,B),c(A,bt)},[()=>jt(t(l).last_used_at),()=>L(t(l).expires_at)]),X("click",yt,B=>{B.preventDefault(),st(t(l).session_uuid)}),v(x,h)}),a(g),a(d),v(o,d)};T(V,o=>{t(r).length===0?o(ht):o(ut,!1)})}var I=i(V,2),W=i(e(I)),pt=e(W);a(W),a(I);var ft=i(I,2);{var mt=o=>{var d=At();v(o,d)},gt=o=>{var d=Ct(),g=i(e(d));C(g,21,()=>t(n),G,(x,l)=>{var h=Bt(),u=e(h),k=e(u,!0);a(u);var f=i(u),w=e(f,!0);a(f);var m=i(f),q=e(m,!0);a(m);var y=i(m),A=e(y);a(y),a(h),S(b=>{c(k,t(l).hash),c(w,t(l).account_id),c(q,b)},[()=>L(t(l).expires_at)]),X("click",A,b=>{b.preventDefault(),rt(t(l).hash)}),v(x,h)}),a(g),a(d),v(o,d)};T(ft,o=>{t(n).length===0?o(mt):o(gt,!1)})}S(()=>{c(lt,`(${t(j).length??""})`),c(_t,`(${t(r).length??""} active)`),c(pt,`(${t(n).length??""} active)`)}),v(s,O)};T(ot,s=>{t(M)?s(it):t(H)?s(nt,1):t(p)&&s(dt,2)})}v(U,K),St()}xt(["click"]);export{Xt as component,Wt as universal};
