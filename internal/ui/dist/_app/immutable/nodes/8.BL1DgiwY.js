import{d as Ee,b as ve,a as y,f as S,s as m}from"../chunks/Ce1JsnIe.js";import{a as ze,o as Ae}from"../chunks/DQV7xeGi.js";import{l as Re,e as Be,a as Ge,K as Ve,ak as We,al as He,c as J,p as Je,a1 as Ke,a2 as b,a3 as ce,a5 as pe,a6 as q,g as a,a7 as Pe,a8 as r,a9 as l,s as f,aa as n,ab as fe,ac as Qe,aj as Ue}from"../chunks/BLL442xA.js";import{i as Xe}from"../chunks/BBj9_ryw.js";import{e as K,i as _e}from"../chunks/CrcuVASb.js";import{r as de}from"../chunks/BXgLrMXN.js";import{s as me,c as Ye}from"../chunks/CQtkrdUT.js";import{b as Ze,a as ea}from"../chunks/C1SpsZ0d.js";import{b as aa}from"../chunks/1EPf5KAz.js";import{a as ta}from"../chunks/0xq203u2.js";import{c as sa}from"../chunks/BmngOAiL.js";function ge(t,i,o=!1){if(t.multiple){if(i==null)return;if(!Ve(i))return We();for(var c of t.options)c.selected=i.includes(w(c));return}for(c of t.options){var _=w(c);if(He(_,i)){c.selected=!0;return}}(!o||i!==void 0)&&(t.selectedIndex=-1)}function ra(t){var i=new MutationObserver(()=>{ge(t,t.__value)});i.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Ge(()=>{i.disconnect()})}function be(t,i,o=i){var c=new WeakSet,_=!0;Re(t,"change",u=>{var d=u?"[selected]":":checked",p;if(t.multiple)p=[].map.call(t.querySelectorAll(d),w);else{var g=t.querySelector(d)??t.querySelector("option:not([disabled])");p=g&&w(g)}o(p),J!==null&&c.add(J)}),Be(()=>{var u=i();if(t===document.activeElement){var d=Je??J;if(c.has(d))return}if(ge(t,u,_),_&&u===void 0){var p=t.querySelector(":checked");p!==null&&(u=w(p),o(u))}t.__value=u,_=!1}),ra(t)}function w(t){return"__value"in t?t.__value:t.value}const la=!1,wa=Object.freeze(Object.defineProperty({__proto__:null,ssr:la},Symbol.toStringTag,{value:"Module"}));var na=S("<option> </option>"),oa=S(' <span class="key svelte-1lsf4ps"> </span><span class="val svelte-1lsf4ps"> </span>',1),ia=S('<div class="log-line svelte-1lsf4ps"><span class="ts svelte-1lsf4ps"> </span> <span> </span> <!></div>'),ua=S('<span class="ts svelte-1lsf4ps">waiting for events...</span>'),va=S('<div class="filters svelte-1lsf4ps"><span></span> <span class="sep">|</span> <label class="svelte-1lsf4ps">level: <select class="svelte-1lsf4ps"><option>all</option><option>error</option><option>warn</option><option>info</option><option>debug</option></select></label> <label class="svelte-1lsf4ps">account: <select class="svelte-1lsf4ps"><option>all accounts</option><!></select></label> <label class="svelte-1lsf4ps">search: <input type="text" placeholder="filter text..." style="width:200px" class="svelte-1lsf4ps"/></label> <label class="svelte-1lsf4ps"><input type="checkbox" class="svelte-1lsf4ps"/> auto-scroll</label> <span class="sep">|</span> <button style="font-size:11px;padding:1px 8px;margin:0"> </button> <button style="font-size:11px;padding:1px 8px;margin:0">clear</button> <span class="muted" style="margin-left:8px"> </span></div> <div class="log-stream svelte-1lsf4ps"><!> <!></div>',1);function Sa(t,i){Ke(i,!0);let o=b(ce([])),c=b(!0),_=b("all"),u=b("all"),d=b(""),p=b(!1),g=b(!1),k=0,P=b(ce([])),h=b(void 0);ze(async()=>{try{f(P,await ta("/accounts"),!0)}catch{}});const xe=sa("/admin/events",{eventTypes:["event","log"],onMessage(e){if(!a(p))try{const s=JSON.parse(e.data);k++,a(o).push({id:k,timestamp:s.timestamp||s.time||new Date().toISOString(),level:(s.level||"info").toLowerCase(),message:s.message||s.msg||"",fields:s.fields||{}}),a(o).length>500&&f(o,a(o).slice(-500),!0),a(c)&&a(h)&&requestAnimationFrame(()=>{a(h)&&(a(h).scrollTop=a(h).scrollHeight)})}catch{k++,a(o).push({id:k,timestamp:new Date().toISOString(),level:"info",message:e.data,fields:{}})}},onOpen(){f(g,!0)},onError(){f(g,!1)}});Ae(()=>xe.close());function he(e){return e==="error"||e==="err"?"lvl-error":e==="warn"||e==="wrn"?"lvl-warn":e==="debug"||e==="dbg"?"lvl-debug":"lvl-info"}function ye(e){return e==="error"?"ERR":e==="warn"?"WRN":e==="debug"?"DBG":"INF"}function we(e){try{const s=new Date(e);return s.toLocaleTimeString("en-GB",{hour12:!1})+"."+String(s.getMilliseconds()).padStart(3,"0")}catch{return e}}function Se(e){if(a(u)==="all")return!0;const s=e.accountId||e.account||"",v=e.accountName||e.name||"";return s===a(u)||v===a(u)}function ke(){return a(o).filter(e=>!(a(_)!=="all"&&e.level!==a(_)||!Se(e.fields)||a(d)&&!(e.message+" "+Object.entries(e.fields).map(([v,x])=>`${v}=${x}`).join(" ")).toLowerCase().includes(a(d).toLowerCase())))}function Le(){f(o,[],!0)}var Q=va(),C=pe(Q),U=l(C);let X;var Y=r(U),F=r(Y,3),I=r(l(F)),T=l(I);T.value=T.__value="all";var D=r(T);D.value=D.__value="error";var M=r(D);M.value=M.__value="warn";var N=r(M);N.value=N.__value="info";var Z=r(N);Z.value=Z.__value="debug",n(I),n(F);var E=r(F,2),z=r(l(E)),A=l(z);A.value=A.__value="all";var Oe=r(A);K(Oe,17,()=>a(P),_e,(e,s)=>{var v=na(),x=l(v,!0);n(v);var O={};q(()=>{m(x,a(s).name),O!==(O=a(s).id)&&(v.value=(v.__value=a(s).id)??"")}),y(e,v)}),n(z),n(E);var R=r(E,2),ee=r(l(R));de(ee),n(R);var B=r(R,2),ae=l(B);de(ae),fe(),n(B);var L=r(B,4),$e=l(L,!0);n(L);var te=r(L,2),se=r(te,2),je=l(se);n(se),n(C);var G=r(C,2),re=l(G);K(re,17,ke,e=>e.id,(e,s)=>{var v=ia(),x=l(v),O=l(x,!0);n(x);var le=r(x);le.nodeValue="  ";var $=r(le),Fe=l($,!0);n($);var ne=r($),Ie=r(ne);K(Ie,17,()=>Object.entries(a(s).fields),_e,(V,W)=>{var j=Qe(()=>Ue(a(W),2));let Te=()=>a(j)[0],De=()=>a(j)[1];fe();var oe=oa(),ie=pe(oe,!0);ie.nodeValue=" ";var H=r(ie),Me=l(H);n(H);var ue=r(H),Ne=l(ue,!0);n(ue),q(()=>{m(Me,`${Te()??""}=`),m(Ne,De())}),y(V,oe)}),n(v),q((V,W,j)=>{m(O,V),me($,1,W,"svelte-1lsf4ps"),m(Fe,j),m(ne,`  ${a(s).message??""} `)},[()=>we(a(s).timestamp),()=>Ye(he(a(s).level)),()=>ye(a(s).level)]),y(e,v)});var qe=r(re,2);{var Ce=e=>{var s=ua();y(e,s)};Xe(qe,e=>{a(o).length===0&&e(Ce)})}n(G),aa(G,e=>f(h,e),()=>a(h)),q(()=>{X=me(U,1,"status-dot svelte-1lsf4ps",null,X,{on:a(g),off:!a(g)}),m(Y,` ${a(g)?"connected":"disconnected"} `),m($e,a(p)?"resume":"pause"),m(je,`${a(o).length??""} lines`)}),be(I,()=>a(_),e=>f(_,e)),be(z,()=>a(u),e=>f(u,e)),Ze(ee,()=>a(d),e=>f(d,e)),ea(ae,()=>a(c),e=>f(c,e)),ve("click",L,()=>f(p,!a(p))),ve("click",te,Le),y(t,Q),Pe()}Ee(["click"]);export{Sa as component,wa as universal};
