import{a as v,f as d,c as ca,t as pa}from"../chunks/DSgr-hxR.js";import{a as Nt,s as I,o as ma,aa as It,g as t,k as h,ac as ha,e,i as a,j,b as Pt,ab as X,f as Ut,d as s}from"../chunks/lUnH5NgY.js";import{s as n,d as fa,a as F}from"../chunks/CMUPHsw8.js";import{i as U}from"../chunks/ChPJZGYw.js";import{s as B,c as M,e as at,r as At,b as et,d as ut,t as Ot,a as qt,i as Dt,j as ba}from"../chunks/CBDcwBok.js";import{s as _t,r as ga}from"../chunks/DUKUYMvf.js";import{b as xa}from"../chunks/CId_XQ1p.js";import{b as ct}from"../chunks/BHL02ULs.js";import{a as Et}from"../chunks/DtH33QRI.js";const ya=!1,oe=Object.freeze(Object.defineProperty({__proto__:null,ssr:ya},Symbol.toStringTag,{value:"Module"}));var ka=d("<td> </td>");function wa(st,Z){Nt(Z,!0);let p=I(ma(Date.now())),A=null,Q=X(()=>Z.until?new Date(Z.until).getTime()-t(p):0),E=X(()=>t(Q)>0),z=X(()=>{if(!t(E))return"–";const O=Math.floor(t(Q)/6e4),V=Math.floor(t(Q)%6e4/1e3);return`${O}m ${String(V).padStart(2,"0")}s`});It(()=>{t(E)&&!A?A=setInterval(()=>{h(p,Date.now(),!0)},1e3):!t(E)&&A&&(clearInterval(A),A=null)}),ha(()=>{A&&clearInterval(A)});var N=ka(),H=e(N,!0);a(N),j(()=>{B(N,1,M(t(E)?"o":"muted")),n(H,t(z))}),v(st,N),Pt()}var ja=d('<p class="error-msg"> </p>'),Ta=d('<p class="loading">loading dashboard...</p>'),Ca=d('<p class="muted">no usage data yet</p>'),Sa=d("<b> </b>"),Ua=d('<tr><td> </td><td class="num"> </td><td class="num"> </td><td class="num"> </td><td class="num"> </td><td class="num"><!></td></tr>'),Aa=d('<table><thead><tr><th></th><th class="num">requests</th><th class="num">input</th><th class="num">output</th><th class="num">cache read</th><th class="num">cost</th></tr></thead><tbody></tbody></table>'),Oa=d('<p class="muted">no accounts</p>'),qa=d('<span class="muted">&ndash;</span>'),Da=d("<span> </span>"),Ea=d('<span class="muted">&ndash;</span>'),Na=d('<span class="muted">&ndash;</span>'),Ia=d("<span> </span>"),Pa=d('<span class="muted">&ndash;</span>'),Ra=d('<tr><td><a> </a></td><td><span> </span></td><td> </td><!><td> </td><td class="num"><!></td><td class="num"><!></td></tr>'),Ba=d('<table><thead><tr><th>email</th><th>status</th><th>pri</th><th>cooldown</th><th>last used</th><th class="num"> </th><th class="num"> </th></tr></thead><tbody></tbody></table>'),Ha=d('<button class="link add-link">[+ add]</button>'),La=d('<span class="r" style="margin-left:8px;"> </span>'),Ma=d('<div class="bar"><input type="text" placeholder="username" style="width:160px;max-width:160px;margin-right:6px;"/> <button class="link">[create]</button> <button class="link">[cancel]</button> <!></div>'),za=d('<div class="bar"><div><span class="g">&#10003; created</span> <b> </b> &mdash; token: <span style="user-select:all;"> </span> <button class="link">[dismiss]</button></div> <div class="r" style="font-size:11px;margin-top:2px;">copy now — this token will not be shown again</div> <div class="test-cmd-wrap svelte-x1i5gj"><button class="copy-btn svelte-x1i5gj"> </button> <pre class="test-cmd svelte-x1i5gj"> </pre></div></div>'),Ga=d('<p class="muted">no users</p>'),Ja=d("<tr><td><a> </a></td><td><span> </span></td><td> </td><td> </td></tr>"),Ka=d('<table><thead><tr><th>name</th><th>status</th><th>last active</th><th class="num">total cost</th></tr></thead><tbody></tbody></table>'),Ya=d('<p class="muted">no events yet</p>'),Fa=d('<li><span class="ts"> </span> <span> </span> </li>'),Qa=d('<ul class="event-list"></ul>'),Va=d('<span class="refresh"><button class="link">[refresh]</button> <span class="muted"> </span></span> <div class="sub"> <span> </span></div> <h2>usage</h2> <!> <h2>accounts <a class="add-link">[+ add]</a></h2> <!> <h2>users <!></h2> <!> <!> <!> <h2>recent events</h2> <!>',1);function ne(st,Z){Nt(Z,!0);let p=I(null),A=I(""),Q=I(""),E=I(!1),z=I(""),N=I(!1),H=I(""),O=I(null),V=I(!1);It(()=>{pt()});async function pt(){try{h(p,await Et("/dashboard"),!0),h(Q,new Date().toLocaleTimeString("en-GB",{hour12:!1}),!0)}catch(f){h(A,f.message,!0)}}function Rt(f){try{return new Date(f).toLocaleTimeString("en-GB",{hour12:!1})}catch{return f}}function mt(){h(E,!1),h(z,""),h(H,"")}async function ht(){const f=t(z).trim();if(!f){h(H,"username required");return}h(N,!0),h(H,"");try{const y=await Et("/users",{method:"POST",body:JSON.stringify({name:f})});h(O,{name:y.name,token:y.token},!0),t(p)&&(t(p).users=[...t(p).users,{id:y.id,name:y.name,status:"active",last_active_at:null,total_cost:0}]),h(E,!1),h(z,"")}catch(y){h(H,y.message,!0)}finally{h(N,!1)}}function ft(f){return`ANTHROPIC_BASE_URL="${typeof window<"u"?window.location.origin:""}" \\
ANTHROPIC_AUTH_TOKEN="${f}" \\
claude -p --model haiku \\
  --system-prompt "You can only output bool" \\
  --tools "StructuredOutput" \\
  --setting-sources "" \\
  --strict-mcp-config \\
  --mcp-config '{"mcpServers":{}}' \\
  --disable-slash-commands \\
  --output-format stream-json \\
  --verbose \\
  --json-schema '{"type":"object","properties":{"result":{"type":"boolean"}},"required":["result"]}' \\
  "Print 'true' for testing purpose"`}async function Bt(){t(O)&&(await navigator.clipboard.writeText(ft(t(O).token)),h(V,!0),setTimeout(()=>{h(V,!1)},2e3))}var bt=ca(),Ht=Ut(bt);{var Lt=f=>{var y=ja(),$=e(y,!0);a(y),j(()=>n($,t(A))),v(f,y)},Mt=f=>{var y=Ta();v(f,y)},zt=f=>{var y=Va(),$=Ut(y),gt=e($),xt=s(gt,2),Gt=e(xt,!0);a(xt),a($);var rt=s($,2),yt=e(rt),ot=s(yt),Jt=e(ot,!0);a(ot),a(rt);var kt=s(rt,4);{var Kt=r=>{var o=Ca();v(r,o)},Yt=r=>{var o=Aa(),c=s(e(o));at(c,23,()=>t(p).usage,_=>_.label,(_,i,b)=>{var k=Ua(),u=e(k),T=e(u,!0);a(u);var g=s(u),x=e(g,!0);a(g);var l=s(g),C=e(l,!0);a(l);var q=s(l),P=e(q,!0);a(q);var G=s(q),J=e(G,!0);a(G);var L=s(G),tt=e(L);{var W=D=>{var S=Sa(),K=e(S,!0);a(S),j(Y=>n(K,Y),[()=>ut(t(i).cost_usd)]),v(D,S)},vt=D=>{var S=pa();j(K=>n(S,K),[()=>ut(t(i).cost_usd)]),v(D,S)};U(tt,D=>{t(b)===t(p).usage.length-1?D(W):D(vt,!1)})}a(L),a(k),j((D,S,K,Y)=>{n(T,t(i).label),n(x,D),n(C,S),n(P,K),n(J,Y)},[()=>et(t(i).requests),()=>et(t(i).input_tokens),()=>et(t(i).output_tokens),()=>et(t(i).cache_read_tokens)]),v(_,k)}),a(c),a(o),v(r,o)};U(kt,r=>{t(p).usage.length===0?r(Kt):r(Yt,!1)})}var nt=s(kt,2),Ft=s(e(nt));a(nt);var wt=s(nt,2);{var Qt=r=>{var o=Oa();v(r,o)},Vt=r=>{const o=X(()=>t(p).accounts.find(x=>x.status==="active"&&x.five_hour_util!=null));var c=Ba(),_=e(c),i=e(_),b=s(e(i),5),k=e(b,!0);a(b);var u=s(b),T=e(u,!0);a(u),a(i),a(_);var g=s(_);at(g,21,()=>t(p).accounts,x=>x.id,(x,l)=>{var C=Ra(),q=e(C),P=e(q),G=e(P,!0);a(P),a(q);var J=s(q),L=e(J),tt=e(L,!0);a(L),a(J);var W=s(J),vt=e(W,!0);a(W);var D=s(W);wa(D,{get until(){return t(l).overloaded_until}});var S=s(D),K=e(S,!0);a(S);var Y=s(S),oa=e(Y);{var na=m=>{var w=qa();v(m,w)},la=m=>{const w=X(()=>100-t(l).five_hour_util);var R=Da(),it=e(R);a(R),j(dt=>{B(R,1,dt,"svelte-x1i5gj"),n(it,`${t(w)??""}%`)},[()=>M(Dt(t(w)))]),v(m,R)},va=m=>{var w=Ea();v(m,w)};U(oa,m=>{t(l).status==="blocked"||t(l).status==="disabled"?m(na):t(l).five_hour_util!=null?m(la,1):m(va,!1)})}a(Y);var St=s(Y),ia=e(St);{var da=m=>{var w=Na();v(m,w)},ua=m=>{const w=X(()=>100-t(l).seven_day_util);var R=Ia(),it=e(R);a(R),j(dt=>{B(R,1,dt,"svelte-x1i5gj"),n(it,`${t(w)??""}%`)},[()=>M(Dt(t(w)))]),v(m,R)},_a=m=>{var w=Pa();v(m,w)};U(ia,m=>{t(l).status==="blocked"||t(l).status==="disabled"?m(da):t(l).seven_day_util!=null?m(ua,1):m(_a,!1)})}a(St),a(C),j((m,w)=>{_t(P,"href",`${ct??""}/accounts/${t(l).id??""}`),n(G,t(l).email),B(L,1,m,"svelte-x1i5gj"),n(tt,t(l).status),B(W,1,M(t(l).priority_mode==="auto"?"muted":"")),n(vt,t(l).priority_mode==="auto"?"auto":t(l).priority),n(K,w)},[()=>M(Ot(t(l).status)),()=>qt(t(l).last_used_at??"")]),v(x,C)}),a(g),a(c),j((x,l)=>{n(k,x),n(T,l)},[()=>t(o)?At(t(o).five_hour_reset,"5h"):"5h",()=>t(o)?At(t(o).seven_day_reset,"7d"):"7d"]),v(r,c)};U(wt,r=>{t(p).accounts.length===0?r(Qt):r(Vt,!1)})}var lt=s(wt,2),Wt=s(e(lt));{var Xt=r=>{var o=Ha();F("click",o,()=>{h(E,!0)}),v(r,o)};U(Wt,r=>{!t(E)&&!t(O)&&r(Xt)})}a(lt);var jt=s(lt,2);{var Zt=r=>{var o=Ma(),c=e(o);ga(c);var _=s(c,2),i=s(_,2),b=s(i,2);{var k=u=>{var T=La(),g=e(T,!0);a(T),j(()=>n(g,t(H))),v(u,T)};U(b,u=>{t(H)&&u(k)})}a(o),j(()=>{c.disabled=t(N),_.disabled=t(N),i.disabled=t(N)}),F("keydown",c,u=>{u.key==="Enter"&&ht(),u.key==="Escape"&&mt()}),xa(c,()=>t(z),u=>h(z,u)),F("click",_,ht),F("click",i,mt),v(r,o)};U(jt,r=>{t(E)&&r(Zt)})}var Tt=s(jt,2);{var $t=r=>{var o=za(),c=e(o),_=s(e(c),2),i=e(_,!0);a(_);var b=s(_,2),k=e(b,!0);a(b);var u=s(b,2);a(c);var T=s(c,4),g=e(T),x=e(g,!0);a(g);var l=s(g,2),C=e(l,!0);a(l),a(T),a(o),j(q=>{n(i,t(O).name),n(k,t(O).token),n(x,t(V)?"[copied]":"[copy]"),n(C,q)},[()=>ft(t(O).token)]),F("click",u,()=>{h(O,null),h(V,!1)}),F("click",g,Bt),v(r,o)};U(Tt,r=>{t(O)&&r($t)})}var Ct=s(Tt,2);{var ta=r=>{var o=Ga();v(r,o)},aa=r=>{var o=Ka(),c=s(e(o));at(c,21,()=>t(p).users,_=>_.id,(_,i)=>{var b=Ja(),k=e(b),u=e(k),T=e(u,!0);a(u),a(k);var g=s(k),x=e(g),l=e(x,!0);a(x),a(g);var C=s(g),q=e(C,!0);a(C);var P=s(C),G=e(P,!0);a(P),a(b),j((J,L,tt)=>{_t(u,"href",`${ct??""}/users/${t(i).id??""}`),n(T,t(i).name),B(x,1,J,"svelte-x1i5gj"),n(l,t(i).status),n(q,L),B(P,1,`num ${t(i).total_cost===0?"muted":""}`),n(G,tt)},[()=>M(Ot(t(i).status)),()=>qt(t(i).last_active_at??""),()=>ut(t(i).total_cost)]),v(_,b)}),a(c),a(o),v(r,o)};U(Ct,r=>{t(p).users.length===0?r(ta):r(aa,!1)})}var ea=s(Ct,4);{var sa=r=>{var o=Ya();v(r,o)},ra=r=>{var o=Qa();at(o,21,()=>t(p).events,c=>c.ts,(c,_)=>{var i=Fa(),b=e(i),k=e(b,!0);a(b);var u=s(b,2),T=e(u,!0);a(u);var g=s(u);a(i),j((x,l,C)=>{n(k,x),B(u,1,l,"svelte-x1i5gj"),n(T,C),n(g,` ${t(_).message??""}`)},[()=>Rt(t(_).ts),()=>M(ba(t(_).type)),()=>t(_).type.toUpperCase()]),v(c,i)}),a(o),v(r,o)};U(ea,r=>{t(p).events.length===0?r(sa):r(ra,!1)})}j(()=>{n(Gt,t(Q)),n(yt,`${t(p).health.version??""} · up ${t(p).health.uptime??""} · sqlite `),B(ot,1,M(t(p).health.sqlite==="ok"?"g":"r")),n(Jt,t(p).health.sqlite),_t(Ft,"href",`${ct??""}/add-account`)}),F("click",gt,pt),v(f,y)};U(Ht,f=>{t(A)?f(Lt):t(p)?f(zt,!1):f(Mt,1)})}v(st,bt),Pt()}fa(["click","keydown"]);export{ne as component,oe as universal};
