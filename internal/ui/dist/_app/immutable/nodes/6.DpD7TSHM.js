import{d as ha,c as ma,a as _,s as n,f as l,b as pt}from"../chunks/Ce1JsnIe.js";import{o as Tt}from"../chunks/DQV7xeGi.js";import{a1 as fa,a2 as Q,a3 as ht,a4 as ba,s as U,a5 as Dt,a7 as ga,g as t,a9 as e,aa as a,a6 as E,a8 as r,ab as Et,ac as W}from"../chunks/BLL442xA.js";import{i as X}from"../chunks/BBj9_ryw.js";import{e as N,i as I}from"../chunks/CrcuVASb.js";import{s as jt}from"../chunks/BXgLrMXN.js";import{c as at,s as et}from"../chunks/CQtkrdUT.js";import{b as Ot}from"../chunks/BE41A0-c.js";import{a as J}from"../chunks/0xq203u2.js";import{s as ya,f as M,t as xa}from"../chunks/C5Uh6Ygl.js";import{c as ka}from"../chunks/BmngOAiL.js";const wa=!1,re=Object.freeze(Object.defineProperty({__proto__:null,ssr:wa},Symbol.toStringTag,{value:"Module"}));var Sa=l('<p class="error-msg"> </p>'),qa=l('<p class="loading">loading dashboard...</p>'),Ta=l('<p class="muted">no usage data yet</p>'),Da=l("<th> </th>"),Ea=l('<td class="num"> </td>'),ja=l('<td class="num"> </td>'),Oa=l('<td class="num"> </td>'),Ca=l('<td class="num"> </td>'),Aa=l('<table><thead><tr><th></th><!><th>total</th></tr></thead><tbody><tr><td>requests</td><!><td class="num"><b> </b></td></tr><tr><td>input tokens</td><!><td class="num"><b> </b></td></tr><tr><td>output tokens</td><!><td class="num"><b> </b></td></tr><tr><td>cache read</td><!><td class="num"><b> </b></td></tr></tbody></table>'),Ma=l('<p class="muted">no activity today</p>'),Ra=l('<tr><td><a> </a></td><td class="num"> </td><td class="num"> </td><td class="num"> </td><td class="ascii-bar"> </td></tr>'),Ha=l("<table><thead><tr><th>user</th><th>reqs</th><th>input</th><th>output</th><th></th></tr></thead><tbody></tbody></table>"),Pa=l('<p class="muted">no activity today</p>'),Ua=l('<tr><td> </td><td class="num"> </td><td class="num"> </td><td class="num"> </td><td class="ascii-bar"> </td></tr>'),Na=l("<table><thead><tr><th>account</th><th>reqs</th><th>input</th><th>output</th><th></th></tr></thead><tbody></tbody></table>"),Ia=l('<p class="muted">no accounts</p>'),Ja=l('<tr><td><a> </a></td><td><span> </span></td><td> </td><td> </td><td> </td><td> </td><td class="acct-actions svelte-x1i5gj"><a href="javascript:void(0)" class="svelte-x1i5gj">refresh</a> <a href="javascript:void(0)" class="svelte-x1i5gj"> </a> <a href="javascript:void(0)" class="r svelte-x1i5gj">delete</a></td></tr>'),Ba=l("<table><thead><tr><th>name</th><th>status</th><th>pri</th><th>cooldown</th><th>5h window</th><th>last used</th><th></th></tr></thead><tbody></tbody></table>"),La=l('<p class="muted">waiting for events...</p>'),za=l('<li><span class="ts"> </span> <span> </span> </li>'),Fa=l('<ul class="event-list"></ul>'),Ga=l('<div class="bar"><span>sqlite: <b class="g"> </b></span> <span>uptime: <b> </b></span> <span>version: <b> </b></span> <span>accounts: <b> </b> total, <b class="g"> </b> active, <b class="o"> </b> cooldown, <b class="r"> </b> blocked</span></div>  <h2>usage (7 days)</h2> <!> <div class="grid"><div><h2>users (today)</h2> <!></div> <div><h2>accounts (today)</h2> <!></div></div> <h2>accounts</h2> <!> <h2>recent events</h2> <!>',1);function se(Ct,At){fa(At,!0);let Y=Q(null),V=Q(ht([])),j=Q(null),Z=Q(ht([])),rt=Q("");ba(()=>{Mt()});async function Mt(){try{const[o,s,p]=await Promise.all([J("/health"),J("/accounts"),J("/dashboard")]);U(Y,o,!0),U(V,s,!0),U(j,p,!0)}catch(o){U(rt,o.message,!0)}}const Rt=ka("/admin/events",{eventTypes:["event"],onMessage(o){try{const s=JSON.parse(o.data);U(Z,[{timestamp:s.timestamp||s.time||new Date().toISOString(),type:s.type||s.eventType||"",message:s.message||s.msg||""},...t(Z)].slice(0,20),!0)}catch{}}});Tt(()=>Rt.close());let st=Q(ht(Date.now()));const Ht=setInterval(()=>{U(st,Date.now(),!0)},1e3);Tt(()=>clearInterval(Ht));function Pt(o){if(!o)return"–";const s=new Date(o).getTime()-t(st);if(s<=0)return"–";const p=Math.floor(s/6e4),K=Math.floor(s%6e4/1e3);return`${p}m ${String(K).padStart(2,"0")}s`}function Ut(o){return o==="active"?"tag tag-active":o==="blocked"?"tag tag-blocked":o==="error"?"tag tag-error":o==="disabled"?"tag tag-disabled":o==="overloaded"?"tag tag-overloaded":"tag"}function Nt(o){return o==="allowed"?"g":o==="warning"?"o":o==="rejected"?"r":"muted"}function It(o){const s=o.toUpperCase();return s==="BAN"||s==="403"||s==="401"?"r":s==="429"||s==="5H-STOP"||s==="5H-REJECT"?"o":s==="REFRESH"||s==="RECOVER"?"g":"muted"}function Jt(o){try{return new Date(o).toLocaleTimeString("en-GB",{hour12:!1})}catch{return o}}async function Bt(o){try{await J(`/accounts/${o}/refresh`,{method:"POST"}),U(V,await J("/accounts"),!0)}catch(s){alert(s.message)}}async function Lt(o,s){const p=s==="disabled"?"active":"disabled";try{await J(`/accounts/${o}/status`,{method:"POST",body:JSON.stringify({status:p})}),U(V,await J("/accounts"),!0)}catch(K){alert(K.message)}}async function zt(o,s){if(confirm(`Delete account ${s}?`))try{await J(`/accounts/${o}`,{method:"DELETE"}),U(V,await J("/accounts"),!0)}catch(p){alert(p.message)}}function mt(o,s){if(s===0)return"";const p=Math.round(o/s*20);return"█".repeat(p)}function Ft(o){return(o??[]).reduce((s,p)=>({request_count:s.request_count+p.request_count,input_tokens:s.input_tokens+p.input_tokens,output_tokens:s.output_tokens+p.output_tokens,cache_read_tokens:s.cache_read_tokens+p.cache_read_tokens}),{request_count:0,input_tokens:0,output_tokens:0,cache_read_tokens:0})}var ft=ma(),Gt=Dt(ft);{var Vt=o=>{var s=Sa(),p=e(s,!0);a(s),E(()=>n(p,t(rt))),_(o,s)},Kt=o=>{var s=qa();_(o,s)},Qt=o=>{const s=W(()=>t(j).daily_usage??[]),p=W(()=>Ft(t(s)));var K=Ga(),ot=Dt(K),nt=e(ot),bt=r(e(nt)),Wt=e(bt,!0);a(bt),a(nt);var ut=r(nt,2),gt=r(e(ut)),Xt=e(gt,!0);a(gt),a(ut);var dt=r(ut,2),yt=r(e(dt)),Yt=e(yt,!0);a(yt),a(dt);var xt=r(dt,2),vt=r(e(xt)),Zt=e(vt,!0);a(vt);var ct=r(vt,2),$t=e(ct,!0);a(ct);var _t=r(ct,2),ta=e(_t,!0);a(_t);var kt=r(_t,2),aa=e(kt,!0);a(kt),Et(),a(xt),a(ot);var wt=r(ot,4);{var ea=u=>{var v=Ta();_(u,v)},ra=u=>{var v=Aa(),D=e(v),f=e(D),d=r(e(f));N(d,17,()=>t(s),I,(q,T)=>{var c=Da(),O=e(c,!0);a(c),E(G=>n(O,G),[()=>ya(t(T).date)]),_(q,c)}),Et(),a(f),a(D);var m=r(D),i=e(m),h=r(e(i));N(h,17,()=>t(s),I,(q,T)=>{var c=Ea(),O=e(c,!0);a(c),E(()=>n(O,t(T).request_count)),_(q,c)});var b=r(h),g=e(b),x=e(g,!0);a(g),a(b),a(i);var k=r(i),y=r(e(k));N(y,17,()=>t(s),I,(q,T)=>{var c=ja(),O=e(c,!0);a(c),E(G=>n(O,G),[()=>M(t(T).input_tokens)]),_(q,c)});var C=r(y),w=e(C),R=e(w,!0);a(w),a(C),a(k);var S=r(k),H=r(e(S));N(H,17,()=>t(s),I,(q,T)=>{var c=Oa(),O=e(c,!0);a(c),E(G=>n(O,G),[()=>M(t(T).output_tokens)]),_(q,c)});var A=r(H),B=e(A),L=e(B,!0);a(B),a(A),a(S);var z=r(S),F=r(e(z));N(F,17,()=>t(s),I,(q,T)=>{var c=Ca(),O=e(c,!0);a(c),E(G=>n(O,G),[()=>M(t(T).cache_read_tokens)]),_(q,c)});var $=r(F),tt=e($),P=e(tt,!0);a(tt),a($),a(z),a(m),a(v),E((q,T,c)=>{n(x,t(p).request_count),n(R,q),n(L,T),n(P,c)},[()=>M(t(p).input_tokens),()=>M(t(p).output_tokens),()=>M(t(p).cache_read_tokens)]),_(u,v)};X(wt,u=>{t(s).length===0?u(ea):u(ra,!1)})}var it=r(wt,2),lt=e(it),sa=r(e(lt),2);{var oa=u=>{var v=Ma();_(u,v)},na=u=>{const v=W(()=>t(j).top_users??[]),D=W(()=>Math.max(...t(v).map(m=>m.request_count)));var f=Ha(),d=r(e(f));N(d,21,()=>t(v),I,(m,i)=>{var h=Ra(),b=e(h),g=e(b),x=e(g,!0);a(g),a(b);var k=r(b),y=e(k,!0);a(k);var C=r(k),w=e(C,!0);a(C);var R=r(C),S=e(R,!0);a(R);var H=r(R),A=e(H,!0);a(H),a(h),E((B,L,z)=>{jt(g,"href",`${Ot??""}/users/${t(i).key??""}`),n(x,t(i).key),n(y,t(i).request_count),n(w,B),n(S,L),n(A,z)},[()=>M(t(i).input_tokens),()=>M(t(i).output_tokens),()=>mt(t(i).request_count,t(D))]),_(m,h)}),a(d),a(f),_(u,f)};X(sa,u=>{(t(j).top_users??[]).length===0?u(oa):u(na,!1)})}a(lt);var St=r(lt,2),ua=r(e(St),2);{var da=u=>{var v=Pa();_(u,v)},va=u=>{const v=W(()=>t(j).top_accounts??[]),D=W(()=>Math.max(...t(v).map(m=>m.request_count)));var f=Na(),d=r(e(f));N(d,21,()=>t(v),I,(m,i)=>{var h=Ua(),b=e(h),g=e(b,!0);a(b);var x=r(b),k=e(x,!0);a(x);var y=r(x),C=e(y,!0);a(y);var w=r(y),R=e(w,!0);a(w);var S=r(w),H=e(S,!0);a(S),a(h),E((A,B,L)=>{n(g,t(i).key),n(k,t(i).request_count),n(C,A),n(R,B),n(H,L)},[()=>M(t(i).input_tokens),()=>M(t(i).output_tokens),()=>mt(t(i).request_count,t(D))]),_(m,h)}),a(d),a(f),_(u,f)};X(ua,u=>{(t(j).top_accounts??[]).length===0?u(da):u(va,!1)})}a(St),a(it);var qt=r(it,4);{var ca=u=>{var v=Ia();_(u,v)},_a=u=>{var v=Ba(),D=r(e(v));N(D,21,()=>t(V),I,(f,d)=>{var m=Ja(),i=e(m),h=e(i),b=e(h,!0);a(h),a(i);var g=r(i),x=e(g),k=e(x,!0);a(x),a(g);var y=r(g),C=e(y,!0);a(y);var w=r(y),R=e(w,!0);a(w);var S=r(w),H=e(S,!0);a(S);var A=r(S),B=e(A,!0);a(A);var L=r(A),z=e(L),F=r(z,2),$=e(F,!0);a(F);var tt=r(F,2);a(L),a(m),E((P,q,T,c,O)=>{jt(h,"href",`${Ot??""}/accounts/${t(d).id??""}`),n(b,t(d).name),et(x,1,P),n(k,t(d).status),n(C,t(d).priority),et(w,1,q),n(R,T),et(S,1,c),n(H,t(d).fiveHourStatus||"–"),n(B,O),n($,t(d).status==="disabled"?"enable":"disable")},[()=>at(Ut(t(d).status)),()=>at(t(d).overloadedUntil&&new Date(t(d).overloadedUntil).getTime()>t(st)?"o":"muted"),()=>Pt(t(d).overloadedUntil),()=>at(Nt(t(d).fiveHourStatus)),()=>xa(t(d).lastUsedAt??"")]),pt("click",z,P=>{P.preventDefault(),Bt(t(d).id)}),pt("click",F,P=>{P.preventDefault(),Lt(t(d).id,t(d).status)}),pt("click",tt,P=>{P.preventDefault(),zt(t(d).id,t(d).name)}),_(f,m)}),a(D),a(v),_(u,v)};X(qt,u=>{t(V).length===0?u(ca):u(_a,!1)})}var ia=r(qt,4);{var la=u=>{var v=La();_(u,v)},pa=u=>{var v=Fa();N(v,21,()=>t(Z),I,(D,f)=>{var d=za(),m=e(d),i=e(m,!0);a(m);var h=r(m,2),b=e(h,!0);a(h);var g=r(h);a(d),E((x,k,y)=>{n(i,x),et(h,1,k),n(b,y),n(g,` ${t(f).message??""}`)},[()=>Jt(t(f).timestamp),()=>at(It(t(f).type)),()=>t(f).type.toUpperCase()]),_(D,d)}),a(v),_(u,v)};X(ia,u=>{t(Z).length===0?u(la):u(pa,!1)})}E(()=>{n(Wt,t(Y).sqlite),n(Xt,t(Y).uptime),n(Yt,t(Y).version),n(Zt,t(j).account_summary.total),n($t,t(j).account_summary.active),n(ta,t(j).account_summary.overloaded),n(aa,t(j).account_summary.blocked)}),_(o,K)};X(Gt,o=>{t(rt)?o(Vt):!t(Y)||!t(j)?o(Kt,1):o(Qt,!1)})}_(Ct,ft),ga()}ha(["click"]);export{se as component,re as universal};
