import{a as v,f as p,c as ta,t as aa}from"../chunks/Cefu_kJh.js";import{a as St,s as D,o as ea,aa as Ut,g as t,k as _,ac as ra,e,i as a,j,b as At,ab as ot,f as kt,d as s}from"../chunks/xTExy2GW.js";import{s as l,d as sa,a as L}from"../chunks/C8R120ip.js";import{i as q}from"../chunks/Bbanrw_8.js";import{s as M,c as J,e as X,b as Z,d as nt,t as wt,a as jt,p as Tt,i as oa}from"../chunks/CYqJDZ5k.js";import{s as lt,r as na}from"../chunks/Buwlz4xJ.js";import{b as la}from"../chunks/CKMoCsps.js";import{b as dt}from"../chunks/RY6GoAMc.js";import{a as Ct}from"../chunks/DtH33QRI.js";const da=!1,Ha=Object.freeze(Object.defineProperty({__proto__:null,ssr:da},Symbol.toStringTag,{value:"Module"}));var ia=p("<td> </td>");function va($,K){St(K,!0);let c=D(ea(Date.now())),T=null,z=ot(()=>K.until?new Date(K.until).getTime()-t(c):0),S=ot(()=>t(z)>0),B=ot(()=>{if(!t(S))return"–";const C=Math.floor(t(z)/6e4),G=Math.floor(t(z)%6e4/1e3);return`${C}m ${String(G).padStart(2,"0")}s`});Ut(()=>{t(S)&&!T?T=setInterval(()=>{_(c,Date.now(),!0)},1e3):!t(S)&&T&&(clearInterval(T),T=null)}),ra(()=>{T&&clearInterval(T)});var U=ia(),P=e(U,!0);a(U),j(()=>{M(U,1,J(t(S)?"o":"muted")),l(P,t(B))}),v($,U),At()}var ua=p('<p class="error-msg"> </p>'),ca=p('<p class="loading">loading dashboard...</p>'),_a=p('<p class="muted">no usage data yet</p>'),pa=p("<b> </b>"),ma=p('<tr><td> </td><td class="num"> </td><td class="num"> </td><td class="num"> </td><td class="num"> </td><td class="num"><!></td></tr>'),ha=p('<table><thead><tr><th></th><th class="num">requests</th><th class="num">input</th><th class="num">output</th><th class="num">cache read</th><th class="num">cost</th></tr></thead><tbody></tbody></table>'),fa=p('<p class="muted">no accounts</p>'),ba=p("<tr><td><a> </a></td><td><span> </span></td><td> </td><!><td> </td><td> </td><td> </td></tr>"),ga=p('<table><thead><tr><th>name</th><th>status</th><th>pri</th><th>cooldown</th><th>last used</th><th class="num">5h</th><th class="num">7d</th></tr></thead><tbody></tbody></table>'),xa=p('<button class="link add-link">[+ add]</button>'),ya=p('<span class="r" style="margin-left:8px;"> </span>'),ka=p('<div class="bar"><input type="text" placeholder="username" style="width:160px;max-width:160px;margin-right:6px;"/> <button class="link">[create]</button> <button class="link">[cancel]</button> <!></div>'),wa=p('<div class="bar"><div><span class="g">&#10003; created</span> <b> </b> &mdash; token: <span style="user-select:all;"> </span> <button class="link">[dismiss]</button></div> <div class="r" style="font-size:11px;margin-top:2px;">copy now — this token will not be shown again</div> <div class="test-cmd-wrap svelte-x1i5gj"><button class="copy-btn svelte-x1i5gj"> </button> <pre class="test-cmd svelte-x1i5gj"> </pre></div></div>'),ja=p('<p class="muted">no users</p>'),Ta=p("<tr><td><a> </a></td><td><span> </span></td><td> </td><td> </td></tr>"),Ca=p('<table><thead><tr><th>name</th><th>status</th><th>last active</th><th class="num">total cost</th></tr></thead><tbody></tbody></table>'),Sa=p('<p class="muted">no events yet</p>'),Ua=p('<li><span class="ts"> </span> <span> </span> </li>'),Aa=p('<ul class="event-list"></ul>'),Oa=p('<span class="refresh"><button class="link">[refresh]</button> <span class="muted"> </span></span> <div class="sub"> <span> </span></div> <h2>usage</h2> <!> <h2>accounts <a class="add-link">[+ add]</a></h2> <!> <h2>users <!></h2> <!> <!> <!> <h2>recent events</h2> <!>',1);function La($,K){St(K,!0);let c=D(null),T=D(""),z=D(""),S=D(!1),B=D(""),U=D(!1),P=D(""),C=D(null),G=D(!1);Ut(()=>{it()});async function it(){try{_(c,await Ct("/dashboard"),!0),_(z,new Date().toLocaleTimeString("en-GB",{hour12:!1}),!0)}catch(h){_(T,h.message,!0)}}function Ot(h){try{return new Date(h).toLocaleTimeString("en-GB",{hour12:!1})}catch{return h}}function vt(){_(S,!1),_(B,""),_(P,"")}async function ut(){const h=t(B).trim();if(!h){_(P,"username required");return}_(U,!0),_(P,"");try{const g=await Ct("/users",{method:"POST",body:JSON.stringify({name:h})});_(C,{name:g.name,token:g.token},!0),t(c)&&(t(c).users=[...t(c).users,{id:g.id,name:g.name,status:"active",last_active_at:null,total_cost:0}]),_(S,!1),_(B,"")}catch(g){_(P,g.message,!0)}finally{_(U,!1)}}function ct(h){return`ANTHROPIC_BASE_URL="${typeof window<"u"?window.location.origin:""}" \\
ANTHROPIC_AUTH_TOKEN="${h}" \\
claude -p --model haiku \\
  --system-prompt "You can only output bool" \\
  --tools "StructuredOutput" \\
  --setting-sources "" \\
  --strict-mcp-config \\
  --mcp-config '{"mcpServers":{}}' \\
  --disable-slash-commands \\
  --output-format stream-json \\
  --verbose \\
  --json-schema '{"type":"object","properties":{"result":{"type":"boolean"}},"required":["result"]}' \\
  "Print 'true' for testing purpose"`}async function qt(){t(C)&&(await navigator.clipboard.writeText(ct(t(C).token)),_(G,!0),setTimeout(()=>{_(G,!1)},2e3))}var _t=ta(),Dt=kt(_t);{var Et=h=>{var g=ua(),Y=e(g,!0);a(g),j(()=>l(Y,t(T))),v(h,g)},Nt=h=>{var g=ca();v(h,g)},It=h=>{var g=Oa(),Y=kt(g),pt=e(Y),mt=s(pt,2),Mt=e(mt,!0);a(mt),a(Y);var tt=s(Y,2),ht=e(tt),at=s(ht),Pt=e(at,!0);a(at),a(tt);var ft=s(tt,4);{var Rt=o=>{var n=_a();v(o,n)},Bt=o=>{var n=ha(),u=s(e(n));X(u,23,()=>t(c).usage,i=>i.label,(i,r,f)=>{var b=ma(),d=e(b),x=e(d,!0);a(d);var m=s(d),k=e(m,!0);a(m);var w=s(m),y=e(w,!0);a(w);var E=s(w),R=e(E,!0);a(E);var N=s(E),F=e(N,!0);a(N);var I=s(N),Q=e(I);{var V=A=>{var O=pa(),H=e(O,!0);a(O),j(W=>l(H,W),[()=>nt(t(r).cost_usd)]),v(A,O)},st=A=>{var O=aa();j(H=>l(O,H),[()=>nt(t(r).cost_usd)]),v(A,O)};q(Q,A=>{t(f)===t(c).usage.length-1?A(V):A(st,!1)})}a(I),a(b),j((A,O,H,W)=>{l(x,t(r).label),l(k,A),l(y,O),l(R,H),l(F,W)},[()=>Z(t(r).requests),()=>Z(t(r).input_tokens),()=>Z(t(r).output_tokens),()=>Z(t(r).cache_read_tokens)]),v(i,b)}),a(u),a(n),v(o,n)};q(ft,o=>{t(c).usage.length===0?o(Rt):o(Bt,!1)})}var et=s(ft,2),Ht=s(e(et));a(et);var bt=s(et,2);{var Lt=o=>{var n=fa();v(o,n)},zt=o=>{var n=ga(),u=s(e(n));X(u,21,()=>t(c).accounts,i=>i.id,(i,r)=>{var f=ba(),b=e(f),d=e(b),x=e(d,!0);a(d),a(b);var m=s(b),k=e(m),w=e(k,!0);a(k),a(m);var y=s(m),E=e(y,!0);a(y);var R=s(y);va(R,{get until(){return t(r).overloaded_until}});var N=s(R),F=e(N,!0);a(N);var I=s(N),Q=e(I,!0);a(I);var V=s(I),st=e(V,!0);a(V),a(f),j((A,O,H,W,Zt,$t)=>{lt(d,"href",`${dt??""}/accounts/${t(r).id??""}`),l(x,t(r).email),M(k,1,A,"svelte-x1i5gj"),l(w,t(r).status),M(y,1,J(t(r).priority_mode==="auto"?"muted":"")),l(E,t(r).priority_mode==="auto"?"auto":t(r).priority),l(F,O),M(I,1,`num ${H??""}`,"svelte-x1i5gj"),l(Q,W),M(V,1,`num ${Zt??""}`,"svelte-x1i5gj"),l(st,$t)},[()=>J(wt(t(r).status)),()=>jt(t(r).last_used_at??""),()=>Tt(t(r).five_hour_pct),()=>t(r).status==="blocked"||t(r).status==="disabled"?"–":Math.round(t(r).five_hour_pct)+"%",()=>Tt(t(r).seven_day_pct),()=>t(r).status==="blocked"||t(r).status==="disabled"?"–":Math.round(t(r).seven_day_pct)+"%"]),v(i,f)}),a(u),a(n),v(o,n)};q(bt,o=>{t(c).accounts.length===0?o(Lt):o(zt,!1)})}var rt=s(bt,2),Gt=s(e(rt));{var Jt=o=>{var n=xa();L("click",n,()=>{_(S,!0)}),v(o,n)};q(Gt,o=>{!t(S)&&!t(C)&&o(Jt)})}a(rt);var gt=s(rt,2);{var Kt=o=>{var n=ka(),u=e(n);na(u);var i=s(u,2),r=s(i,2),f=s(r,2);{var b=d=>{var x=ya(),m=e(x,!0);a(x),j(()=>l(m,t(P))),v(d,x)};q(f,d=>{t(P)&&d(b)})}a(n),j(()=>{u.disabled=t(U),i.disabled=t(U),r.disabled=t(U)}),L("keydown",u,d=>{d.key==="Enter"&&ut(),d.key==="Escape"&&vt()}),la(u,()=>t(B),d=>_(B,d)),L("click",i,ut),L("click",r,vt),v(o,n)};q(gt,o=>{t(S)&&o(Kt)})}var xt=s(gt,2);{var Yt=o=>{var n=wa(),u=e(n),i=s(e(u),2),r=e(i,!0);a(i);var f=s(i,2),b=e(f,!0);a(f);var d=s(f,2);a(u);var x=s(u,4),m=e(x),k=e(m,!0);a(m);var w=s(m,2),y=e(w,!0);a(w),a(x),a(n),j(E=>{l(r,t(C).name),l(b,t(C).token),l(k,t(G)?"[copied]":"[copy]"),l(y,E)},[()=>ct(t(C).token)]),L("click",d,()=>{_(C,null),_(G,!1)}),L("click",m,qt),v(o,n)};q(xt,o=>{t(C)&&o(Yt)})}var yt=s(xt,2);{var Ft=o=>{var n=ja();v(o,n)},Qt=o=>{var n=Ca(),u=s(e(n));X(u,21,()=>t(c).users,i=>i.id,(i,r)=>{var f=Ta(),b=e(f),d=e(b),x=e(d,!0);a(d),a(b);var m=s(b),k=e(m),w=e(k,!0);a(k),a(m);var y=s(m),E=e(y,!0);a(y);var R=s(y),N=e(R,!0);a(R),a(f),j((F,I,Q)=>{lt(d,"href",`${dt??""}/users/${t(r).id??""}`),l(x,t(r).name),M(k,1,F,"svelte-x1i5gj"),l(w,t(r).status),l(E,I),M(R,1,`num ${t(r).total_cost===0?"muted":""}`),l(N,Q)},[()=>J(wt(t(r).status)),()=>jt(t(r).last_active_at??""),()=>nt(t(r).total_cost)]),v(i,f)}),a(u),a(n),v(o,n)};q(yt,o=>{t(c).users.length===0?o(Ft):o(Qt,!1)})}var Vt=s(yt,4);{var Wt=o=>{var n=Sa();v(o,n)},Xt=o=>{var n=Aa();X(n,21,()=>t(c).events,u=>u.ts,(u,i)=>{var r=Ua(),f=e(r),b=e(f,!0);a(f);var d=s(f,2),x=e(d,!0);a(d);var m=s(d);a(r),j((k,w,y)=>{l(b,k),M(d,1,w,"svelte-x1i5gj"),l(x,y),l(m,` ${t(i).message??""}`)},[()=>Ot(t(i).ts),()=>J(oa(t(i).type)),()=>t(i).type.toUpperCase()]),v(u,r)}),a(n),v(o,n)};q(Vt,o=>{t(c).events.length===0?o(Wt):o(Xt,!1)})}j(()=>{l(Mt,t(z)),l(ht,`${t(c).health.version??""} · up ${t(c).health.uptime??""} · sqlite `),M(at,1,J(t(c).health.sqlite==="ok"?"g":"r")),l(Pt,t(c).health.sqlite),lt(Ht,"href",`${dt??""}/add-account`)}),L("click",pt,it),v(h,g)};q(Dt,h=>{t(T)?h(Et):t(c)?h(It,!1):h(Nt,1)})}v($,_t),At()}sa(["click","keydown"]);export{La as component,Ha as universal};
