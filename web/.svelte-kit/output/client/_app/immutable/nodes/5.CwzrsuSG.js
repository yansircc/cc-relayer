import{a as v,f as i,c as _a,t as ca}from"../chunks/DSgr-hxR.js";import{a as Rt,s as I,o as pa,aa as Bt,g as t,k as m,ac as ma,e,i as a,j as w,b as Ht,ab as et,f as st,d as r}from"../chunks/lUnH5NgY.js";import{s as l,d as ha,a as J}from"../chunks/CMUPHsw8.js";import{i as C}from"../chunks/ChPJZGYw.js";import{s as H,c as K,e as rt,b as nt,d as ht,t as Dt,a as Et,r as Nt,i as It,j as fa}from"../chunks/CjJWkJbP.js";import{s as ft,r as ba}from"../chunks/DUKUYMvf.js";import{b as ga}from"../chunks/CId_XQ1p.js";import{b as bt}from"../chunks/NZDo04p-.js";import{a as Pt}from"../chunks/DtH33QRI.js";const xa=!1,ne=Object.freeze(Object.defineProperty({__proto__:null,ssr:xa},Symbol.toStringTag,{value:"Module"}));var ya=i("<td> </td>");function ka(ot,W){Rt(W,!0);let p=I(pa(Date.now())),U=null,Y=et(()=>W.until?new Date(W.until).getTime()-t(p):0),O=et(()=>t(Y)>0),L=et(()=>{if(!t(O))return"–";const A=Math.floor(t(Y)/6e4),F=Math.floor(t(Y)%6e4/1e3);return`${A}m ${String(F).padStart(2,"0")}s`});Bt(()=>{t(O)&&!U?U=setInterval(()=>{m(p,Date.now(),!0)},1e3):!t(O)&&U&&(clearInterval(U),U=null)}),ma(()=>{U&&clearInterval(U)});var q=ya(),R=e(q,!0);a(q),w(()=>{H(q,1,K(t(O)?"o":"muted")),l(R,t(L))}),v(ot,q),Ht()}var wa=i('<p class="error-msg"> </p>'),ja=i('<p class="loading">loading dashboard...</p>'),Ta=i('<p class="muted">no usage data yet</p>'),Ca=i("<b> </b>"),Sa=i('<tr><td> </td><td class="num"> </td><td class="num"> </td><td class="num"> </td><td class="num"> </td><td class="num"><!></td></tr>'),Ua=i('<table><thead><tr><th></th><th class="num">requests</th><th class="num">input</th><th class="num">output</th><th class="num">cache read</th><th class="num">cost</th></tr></thead><tbody></tbody></table>'),Aa=i('<p class="muted">no accounts</p>'),Oa=i('<span class="muted">(auto)</span>'),qa=i('<span class="muted">&ndash;</span>'),Da=i('<span> </span> <span class="muted"> </span>',1),Ea=i('<span class="muted">&ndash;</span>'),Na=i('<span class="muted">&ndash;</span>'),Ia=i('<span> </span> <span class="muted"> </span>',1),Pa=i('<span class="muted">&ndash;</span>'),Ra=i('<tr><td><a> </a></td><td><span> </span></td><td> <!></td><!><td> </td><td class="num"><!></td><td class="num"><!></td></tr>'),Ba=i('<table><thead><tr><th>email</th><th>status</th><th>pri</th><th>cooldown</th><th>last used</th><th class="num">5h remain</th><th class="num">7d remain</th></tr></thead><tbody></tbody></table>'),Ha=i('<button class="link add-link">[+ add]</button>'),La=i('<span class="r" style="margin-left:8px;"> </span>'),Ma=i('<div class="bar"><input type="text" placeholder="username" style="width:160px;max-width:160px;margin-right:6px;"/> <button class="link">[create]</button> <button class="link">[cancel]</button> <!></div>'),za=i('<div class="bar"><div><span class="g">&#10003; created</span> <b> </b> &mdash; token: <span style="user-select:all;"> </span> <button class="link">[dismiss]</button></div> <div class="r" style="font-size:11px;margin-top:2px;">copy now — this token will not be shown again</div> <div class="test-cmd-wrap svelte-x1i5gj"><button class="copy-btn svelte-x1i5gj"> </button> <pre class="test-cmd svelte-x1i5gj"> </pre></div></div>'),Ga=i('<p class="muted">no users</p>'),Ja=i("<tr><td><a> </a></td><td><span> </span></td><td> </td><td> </td></tr>"),Ka=i('<table><thead><tr><th>name</th><th>status</th><th>last active</th><th class="num">total cost</th></tr></thead><tbody></tbody></table>'),Ya=i('<p class="muted">no events yet</p>'),Fa=i('<li><span class="ts"> </span> <span> </span> </li>'),Qa=i('<ul class="event-list"></ul>'),Va=i('<span class="refresh"><button class="link">[refresh]</button> <span class="muted"> </span></span> <div class="sub"> <span> </span></div> <h2>usage</h2> <!> <h2>accounts <a class="add-link">[+ add]</a></h2> <!> <h2>users <!></h2> <!> <!> <!> <h2>recent events</h2> <!>',1);function oe(ot,W){Rt(W,!0);let p=I(null),U=I(""),Y=I(""),O=I(!1),L=I(""),q=I(!1),R=I(""),A=I(null),F=I(!1);Bt(()=>{gt()});async function gt(){try{m(p,await Pt("/dashboard"),!0),m(Y,new Date().toLocaleTimeString("en-GB",{hour12:!1}),!0)}catch(f){m(U,f.message,!0)}}function Lt(f){try{return new Date(f).toLocaleTimeString("en-GB",{hour12:!1})}catch{return f}}function xt(){m(O,!1),m(L,""),m(R,"")}async function yt(){const f=t(L).trim();if(!f){m(R,"username required");return}m(q,!0),m(R,"");try{const y=await Pt("/users",{method:"POST",body:JSON.stringify({name:f})});m(A,{name:y.name,token:y.token},!0),t(p)&&(t(p).users=[...t(p).users,{id:y.id,name:y.name,status:"active",last_active_at:null,total_cost:0}]),m(O,!1),m(L,"")}catch(y){m(R,y.message,!0)}finally{m(q,!1)}}function kt(f){return`ANTHROPIC_BASE_URL="${typeof window<"u"?window.location.origin:""}" \\
ANTHROPIC_AUTH_TOKEN="${f}" \\
claude -p --model haiku \\
  --system-prompt "You can only output bool" \\
  --tools "StructuredOutput" \\
  --setting-sources "" \\
  --strict-mcp-config \\
  --mcp-config '{"mcpServers":{}}' \\
  --disable-slash-commands \\
  --output-format stream-json \\
  --verbose \\
  --json-schema '{"type":"object","properties":{"result":{"type":"boolean"}},"required":["result"]}' \\
  "Print 'true' for testing purpose"`}async function Mt(){t(A)&&(await navigator.clipboard.writeText(kt(t(A).token)),m(F,!0),setTimeout(()=>{m(F,!1)},2e3))}var wt=_a(),zt=st(wt);{var Gt=f=>{var y=wa(),X=e(y,!0);a(y),w(()=>l(X,t(U))),v(f,y)},Jt=f=>{var y=ja();v(f,y)},Kt=f=>{var y=Va(),X=st(y),jt=e(X),Tt=r(jt,2),Yt=e(Tt,!0);a(Tt),a(X);var lt=r(X,2),Ct=e(lt),vt=r(Ct),Ft=e(vt,!0);a(vt),a(lt);var St=r(lt,4);{var Qt=n=>{var o=Ta();v(n,o)},Vt=n=>{var o=Ua(),c=r(e(o));rt(c,23,()=>t(p).usage,_=>_.label,(_,s,b)=>{var g=Sa(),d=e(g),k=e(d,!0);a(d);var h=r(d),j=e(h,!0);a(h);var S=r(h),T=e(S,!0);a(S);var D=r(S),M=e(D,!0);a(D);var z=r(D),Q=e(z,!0);a(z);var B=r(z),Z=e(B);{var $=E=>{var N=Ca(),G=e(N,!0);a(N),w(V=>l(G,V),[()=>ht(t(s).cost_usd)]),v(E,N)},ut=E=>{var N=ca();w(G=>l(N,G),[()=>ht(t(s).cost_usd)]),v(E,N)};C(Z,E=>{t(b)===t(p).usage.length-1?E($):E(ut,!1)})}a(B),a(g),w((E,N,G,V)=>{l(k,t(s).label),l(j,E),l(T,N),l(M,G),l(Q,V)},[()=>nt(t(s).requests),()=>nt(t(s).input_tokens),()=>nt(t(s).output_tokens),()=>nt(t(s).cache_read_tokens)]),v(_,g)}),a(c),a(o),v(n,o)};C(St,n=>{t(p).usage.length===0?n(Qt):n(Vt,!1)})}var it=r(St,2),Wt=r(e(it));a(it);var Ut=r(it,2);{var Xt=n=>{var o=Aa();v(n,o)},Zt=n=>{var o=Ba(),c=r(e(o));rt(c,21,()=>t(p).accounts,_=>_.id,(_,s)=>{var b=Ra(),g=e(b),d=e(g),k=e(d,!0);a(d),a(g);var h=r(g),j=e(h),S=e(j,!0);a(j),a(h);var T=r(h),D=e(T,!0),M=r(D);{var z=u=>{var x=Oa();v(u,x)};C(M,u=>{t(s).priority_mode==="auto"&&u(z)})}a(T);var Q=r(T);ka(Q,{get until(){return t(s).overloaded_until}});var B=r(Q),Z=e(B,!0);a(B);var $=r(B),ut=e($);{var E=u=>{var x=qa();v(u,x)},N=u=>{const x=et(()=>100-t(s).five_hour_util);var tt=Da(),P=st(tt),_t=e(P);a(P);var at=r(P,2),ct=e(at,!0);a(at),w((pt,mt)=>{H(P,1,pt,"svelte-x1i5gj"),l(_t,`${t(x)??""}%`),l(ct,mt)},[()=>K(Nt(t(x))),()=>It(t(s).five_hour_reset,"5h")]),v(u,tt)},G=u=>{var x=Ea();v(u,x)};C(ut,u=>{t(s).status==="blocked"||t(s).status==="disabled"?u(E):t(s).five_hour_util!=null?u(N,1):u(G,!1)})}a($);var V=r($),va=e(V);{var ia=u=>{var x=Na();v(u,x)},da=u=>{const x=et(()=>100-t(s).seven_day_util);var tt=Ia(),P=st(tt),_t=e(P);a(P);var at=r(P,2),ct=e(at,!0);a(at),w((pt,mt)=>{H(P,1,pt,"svelte-x1i5gj"),l(_t,`${t(x)??""}%`),l(ct,mt)},[()=>K(Nt(t(x))),()=>It(t(s).seven_day_reset,"7d")]),v(u,tt)},ua=u=>{var x=Pa();v(u,x)};C(va,u=>{t(s).status==="blocked"||t(s).status==="disabled"?u(ia):t(s).seven_day_util!=null?u(da,1):u(ua,!1)})}a(V),a(b),w((u,x)=>{ft(d,"href",`${bt??""}/accounts/${t(s).id??""}`),l(k,t(s).email),H(j,1,u,"svelte-x1i5gj"),l(S,t(s).status),l(D,t(s).priority),l(Z,x)},[()=>K(Dt(t(s).status)),()=>Et(t(s).last_used_at??"")]),v(_,b)}),a(c),a(o),v(n,o)};C(Ut,n=>{t(p).accounts.length===0?n(Xt):n(Zt,!1)})}var dt=r(Ut,2),$t=r(e(dt));{var ta=n=>{var o=Ha();J("click",o,()=>{m(O,!0)}),v(n,o)};C($t,n=>{!t(O)&&!t(A)&&n(ta)})}a(dt);var At=r(dt,2);{var aa=n=>{var o=Ma(),c=e(o);ba(c);var _=r(c,2),s=r(_,2),b=r(s,2);{var g=d=>{var k=La(),h=e(k,!0);a(k),w(()=>l(h,t(R))),v(d,k)};C(b,d=>{t(R)&&d(g)})}a(o),w(()=>{c.disabled=t(q),_.disabled=t(q),s.disabled=t(q)}),J("keydown",c,d=>{d.key==="Enter"&&yt(),d.key==="Escape"&&xt()}),ga(c,()=>t(L),d=>m(L,d)),J("click",_,yt),J("click",s,xt),v(n,o)};C(At,n=>{t(O)&&n(aa)})}var Ot=r(At,2);{var ea=n=>{var o=za(),c=e(o),_=r(e(c),2),s=e(_,!0);a(_);var b=r(_,2),g=e(b,!0);a(b);var d=r(b,2);a(c);var k=r(c,4),h=e(k),j=e(h,!0);a(h);var S=r(h,2),T=e(S,!0);a(S),a(k),a(o),w(D=>{l(s,t(A).name),l(g,t(A).token),l(j,t(F)?"[copied]":"[copy]"),l(T,D)},[()=>kt(t(A).token)]),J("click",d,()=>{m(A,null),m(F,!1)}),J("click",h,Mt),v(n,o)};C(Ot,n=>{t(A)&&n(ea)})}var qt=r(Ot,2);{var sa=n=>{var o=Ga();v(n,o)},ra=n=>{var o=Ka(),c=r(e(o));rt(c,21,()=>t(p).users,_=>_.id,(_,s)=>{var b=Ja(),g=e(b),d=e(g),k=e(d,!0);a(d),a(g);var h=r(g),j=e(h),S=e(j,!0);a(j),a(h);var T=r(h),D=e(T,!0);a(T);var M=r(T),z=e(M,!0);a(M),a(b),w((Q,B,Z)=>{ft(d,"href",`${bt??""}/users/${t(s).id??""}`),l(k,t(s).name),H(j,1,Q,"svelte-x1i5gj"),l(S,t(s).status),l(D,B),H(M,1,`num ${t(s).total_cost===0?"muted":""}`),l(z,Z)},[()=>K(Dt(t(s).status)),()=>Et(t(s).last_active_at??""),()=>ht(t(s).total_cost)]),v(_,b)}),a(c),a(o),v(n,o)};C(qt,n=>{t(p).users.length===0?n(sa):n(ra,!1)})}var na=r(qt,4);{var oa=n=>{var o=Ya();v(n,o)},la=n=>{var o=Qa();rt(o,21,()=>t(p).events,c=>c.ts,(c,_)=>{var s=Fa(),b=e(s),g=e(b,!0);a(b);var d=r(b,2),k=e(d,!0);a(d);var h=r(d);a(s),w((j,S,T)=>{l(g,j),H(d,1,S,"svelte-x1i5gj"),l(k,T),l(h,` ${t(_).message??""}`)},[()=>Lt(t(_).ts),()=>K(fa(t(_).type)),()=>t(_).type.toUpperCase()]),v(c,s)}),a(o),v(n,o)};C(na,n=>{t(p).events.length===0?n(oa):n(la,!1)})}w(()=>{l(Yt,t(Y)),l(Ct,`${t(p).health.version??""} · up ${t(p).health.uptime??""} · sqlite `),H(vt,1,K(t(p).health.sqlite==="ok"?"g":"r")),l(Ft,t(p).health.sqlite),ft(Wt,"href",`${bt??""}/add-account`)}),J("click",jt,gt),v(f,y)};C(zt,f=>{t(U)?f(Gt):t(p)?f(Kt,!1):f(Jt,1)})}v(ot,wt),Ht()}ha(["click","keydown"]);export{oe as component,ne as universal};
